{"version":3,"sources":["turbopack:///[project]/apps/market/src/app/auth/cli/page.module.css [app-ssr] (css module)","../../../../../../apps/market/src/app/auth/cli/page.tsx"],"sourcesContent":["__turbopack_context__.v({\n  \"card\": \"page-module___eeNZa__card\",\n  \"checkmark\": \"page-module___eeNZa__checkmark\",\n  \"errorTitle\": \"page-module___eeNZa__errorTitle\",\n  \"icon\": \"page-module___eeNZa__icon\",\n  \"page\": \"page-module___eeNZa__page\",\n  \"spin\": \"page-module___eeNZa__spin\",\n  \"spinner\": \"page-module___eeNZa__spinner\",\n  \"success\": \"page-module___eeNZa__success\",\n});\n","\"use client\";\n\nimport { useSearchParams } from \"next/navigation\";\nimport { useEffect, useState, Suspense } from \"react\";\nimport { createClient } from \"@/lib/supabase/client\";\nimport styles from \"./page.module.css\";\n\nfunction CliAuthContent() {\n  const searchParams = useSearchParams();\n  const redirectUri = searchParams.get(\"redirect\");\n  const [status, setStatus] = useState<\"loading\" | \"authenticating\" | \"success\" | \"error\">(\"loading\");\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    const checkAuthAndRedirect = async () => {\n      const supabase = createClient();\n      const { data: { session } } = await supabase.auth.getSession();\n\n      if (session) {\n        // User is already logged in, generate token and redirect\n        try {\n          const response = await fetch(\"/api/auth/cli-token\", {\n            method: \"POST\",\n            headers: { \"Content-Type\": \"application/json\" },\n          });\n\n          if (response.ok) {\n            const { token } = await response.json();\n\n            if (redirectUri) {\n              // Redirect to CLI's localhost callback\n              window.location.href = `${redirectUri}?token=${token}`;\n            } else {\n              setStatus(\"success\");\n            }\n          } else {\n            throw new Error(\"Failed to generate token\");\n          }\n        } catch {\n          setError(\"Failed to generate CLI token\");\n          setStatus(\"error\");\n        }\n      } else {\n        // Not logged in, start OAuth flow\n        setStatus(\"authenticating\");\n        const { error } = await supabase.auth.signInWithOAuth({\n          provider: \"github\",\n          options: {\n            redirectTo: `${window.location.origin}/auth/cli/callback${redirectUri ? `?redirect=${encodeURIComponent(redirectUri)}` : \"\"}`,\n          },\n        });\n\n        if (error) {\n          setError(error.message);\n          setStatus(\"error\");\n        }\n      }\n    };\n\n    checkAuthAndRedirect();\n  }, [redirectUri]);\n\n  return (\n    <div className={styles.card}>\n      <span className={styles.icon}>üîê</span>\n\n      {status === \"loading\" && (\n        <>\n          <h1>Authenticating CLI...</h1>\n          <p>Please wait while we verify your credentials.</p>\n          <div className={styles.spinner} />\n        </>\n      )}\n\n      {status === \"authenticating\" && (\n        <>\n          <h1>Redirecting to GitHub...</h1>\n          <p>You&apos;ll be redirected to GitHub to authenticate.</p>\n          <div className={styles.spinner} />\n        </>\n      )}\n\n      {status === \"success\" && (\n        <>\n          <h1 className={styles.success}>Authentication Successful!</h1>\n          <p>You can now close this window and return to your terminal.</p>\n          <div className={styles.checkmark}>‚úì</div>\n        </>\n      )}\n\n      {status === \"error\" && (\n        <>\n          <h1 className={styles.errorTitle}>Authentication Failed</h1>\n          <p>{error || \"An unexpected error occurred.\"}</p>\n          <button\n            onClick={() => window.location.reload()}\n            className=\"btn btn-primary\"\n          >\n            Try Again\n          </button>\n        </>\n      )}\n    </div>\n  );\n}\n\nfunction LoadingFallback() {\n  return (\n    <div className={styles.card}>\n      <span className={styles.icon}>üîê</span>\n      <h1>Loading...</h1>\n      <div className={styles.spinner} />\n    </div>\n  );\n}\n\nexport default function CliAuthPage() {\n  return (\n    <div className={styles.page}>\n      <Suspense fallback={<LoadingFallback />}>\n        <CliAuthContent />\n      </Suspense>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}